cd /usr/src

SOURCE_DIR_NAME=linux-${VERSION}-grsec

if [ ! -d ${SOURCE_DIR_NAME} ]; then
    
    rm  -rf  linux-${KERNEL_VERSION}    
    rm  -rf  linux-${KERNEL_RELEASE}    
    rm  -rf  linux						
    
    unpack  ${SOURCE} 
    
    # let's make our source dir have a unique name
    
    mv linux-${KERNEL_RELEASE} ${SOURCE_DIR_NAME} &&    
    ln  -s   ${SOURCE_DIR_NAME}  linux             &&
    
    cd  linux/ &&
    
    patch_it  ${SOURCE2}  1 &&
    
    for config in .config-2.6-grsec .config.2.6.stable
    do
      if [ -f ${CONFIG_CACHE}/${config} ]; then
         cp $CONFIG_CACHE/${config} /usr/src/linux/.config 
         break	
      fi	
    done
    
else

    message "Sources found: /usr/src/${SOURCE_DIR_NAME}" 
    
    if [ "`readlink linux`" != "${SOURCE_DIR_NAME}" ]; then
       rm -rf linux
       ln -s ${SOURCE_DIR_NAME} linux
    fi
    
fi
