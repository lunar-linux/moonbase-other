cd /usr/src

if [ ! -d linux-${VERSION} ]; then
    
    rm  -rf  linux-${VERSION}
    rm  -rf  linux

    unpack  $SOURCE
    
    mv  linux-${K_VERSION} linux-${VERSION}
    ln  -sf  linux-${VERSION}  linux

    chown  root.root  /usr/src/linux
    chown  -R  root.root  /usr/src/linux-${VERSION}

else

    message "Sources found: /usr/src/linux-${VERSION}"
    if ! validate_source_dir ; then
      exit 1
    else
      if [ "`readlink linux`" != "linux-${VERSION}" ]; then
        rm -rf linux
	ln -s linux-${VERSION} linux
      fi
    fi
fi
    
cd  linux/

patch_it $SOURCE2 1

if  [ -f $CONFIG_CACHE/.config.2.6.stable ]; then
    cp $CONFIG_CACHE/.config.2.6.stable $SOURCE_DIRECTORY/.config;
elif [ -f $CONFIG_CACHE/.config.beta ]; then
    cp $CONFIG_CACHE/.config.beta $SOURCE_DIRECTORY/.config;
fi

